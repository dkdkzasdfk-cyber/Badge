<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة المغامرة</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // المتغيرات الأساسية
        let scene, camera, renderer;
        let player, terrain;
        let moveState = { forward: false, backward: false, left: false, right: false };

        // تهيئة اللعبة
        function init() {
            // إنشاء المشهد
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // إنشاء الكاميرا
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            camera.lookAt(0, 0, 0);

            // إنشاء المُصيِّر
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // إضافة الضوء
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // إنشاء الأرض
            createTerrain();
            
            // إنشاء الجبال
            createMountains();
            
            // إنشاء النهر
            createRiver();
            
            // إنشاء الشخصية
            createPlayer();
            
            // إضافة المطر
            createRain();

            // إضافة أحداث التحكم
            setupControls();
            
            // بدء اللعبة
            animate();
        }

        function createTerrain() {
            const terrainGeometry = new THREE.PlaneGeometry(100, 100, 50, 50);
            const terrainMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x3a7e3a
            });
            
            terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
            terrain.rotation.x = -Math.PI / 2;
            terrain.receiveShadow = true;
            scene.add(terrain);
        }

        function createMountains() {
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                const radius = 45;
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                
                const height = 15 + Math.random() * 10;
                const mountainGeometry = new THREE.ConeGeometry(8, height, 8);
                const mountainMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0x5d4037 
                });
                
                const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
                mountain.position.set(x, height/2, z);
                mountain.castShadow = true;
                
                scene.add(mountain);
            }
        }

        function createRiver() {
            const riverGeometry = new THREE.PlaneGeometry(8, 40);
            const riverMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x0077be,
                transparent: true,
                opacity: 0.8
            });
            
            const river = new THREE.Mesh(riverGeometry, riverMaterial);
            river.rotation.x = -Math.PI / 2;
            river.position.set(20, 0.1, 0);
            scene.add(river);
        }

        function createPlayer() {
            // جسم اللاعب
            const bodyGeometry = new THREE.BoxGeometry(0.5, 1.5, 0.3);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            
            // الرأس
            const headGeometry = new THREE.SphereGeometry(0.25);
            const headMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 0.9;
            
            // الخوذة
            const helmetGeometry = new THREE.SphereGeometry(0.3);
            const helmetMaterial = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
            const helmet = new THREE.Mesh(helmetGeometry, helmetMaterial);
            helmet.position.y = 0.9;
            helmet.scale.set(1, 0.8, 1);
            
            player = new THREE.Group();
            player.add(body);
            player.add(head);
            player.add(helmet);
            player.position.set(0, 1, 0);
            
            scene.add(player);
        }

        function createRain() {
            const rainGeometry = new THREE.BufferGeometry();
            const rainCount = 5000;
            const positions = [];

            for (let i = 0; i < rainCount; i++) {
                positions.push(
                    Math.random() * 100 - 50,
                    Math.random() * 50 + 10,
                    Math.random() * 100 - 50
                );
            }

            rainGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            
            const rainMaterial = new THREE.PointsMaterial({
                color: 0xaaaaaa,
                size: 0.1,
                transparent: true
            });

            const rain = new THREE.Points(rainGeometry, rainMaterial);
            scene.add(rain);
        }

        function setupControls() {
            document.addEventListener('keydown', (event) => {
                switch (event.code) {
                    case 'ArrowUp':
                    case 'KeyW':
                        moveState.forward = true;
                        break;
                    case 'ArrowDown':
                    case 'KeyS':
                        moveState.backward = true;
                        break;
                    case 'ArrowLeft':
                    case 'KeyA':
                        moveState.left = true;
                        break;
                    case 'ArrowRight':
                    case 'KeyD':
                        moveState.right = true;
                        break;
                }
            });

            document.addEventListener('keyup', (event) => {
                switch (event.code) {
                    case 'ArrowUp':
                    case 'KeyW':
                        moveState.forward = false;
                        break;
                    case 'ArrowDown':
                    case 'KeyS':
                        moveState.backward = false;
                        break;
                    case 'ArrowLeft':
                    case 'KeyA':
                        moveState.left = false;
                        break;
                    case 'ArrowRight':
                    case 'KeyD':
                        moveState.right = false;
                        break;
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            // تحريك اللاعب
            const speed = 0.5;
            
            if (moveState.forward) {
                player.position.z -= speed;
                camera.position.z -= speed;
            }
            if (moveState.backward) {
                player.position.z += speed;
                camera.position.z += speed;
            }
            if (moveState.left) {
                player.position.x -= speed;
                camera.position.x -= speed;
            }
            if (moveState.right) {
                player.position.x += speed;
                camera.position.x += speed;
            }

            // تحديث نظر الكاميرا لتبع اللاعب
            camera.lookAt(player.position);

            renderer.render(scene, camera);
        }

        // التعامل مع تغيير حجم النافذة
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // تشغيل اللعبة مباشرة
        init();
    </script>
</body>
</html>